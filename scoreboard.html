<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>篮球比赛计时计分系统 - Scoreboard</title>
    <style>
        /* 导入 Inter 字体作为基础，但主要使用 Monospace 模拟数码管效果 */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700&family=D-DIN:wght@700&display=swap');

        :root {
            --color-bg: #000;
            --color-primary: #00FF00; /* Neon Green */
            --color-secondary: #FF4500; /* Neon Orange/Red for emphasis */
            --color-accent: #FFFF00; /* Neon Yellow for emphasis */
            --color-text: #00FF00;
            --color-border: #004400;
            --digital-font: 'D-DIN', 'Inter', monospace; /* 模拟数码管的字体 */
        }

        body {
            background-color: var(--color-bg);
            color: var(--color-text);
            font-family: 'Inter', sans-serif;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            text-shadow: 0 0 5px rgba(0, 255, 0, 0.3); /* 轻微的绿色光晕 */
        }

        /* ---------------------------------- 全局布局 ---------------------------------- */

        .header {
            width: 90%;
            max-width: 1600px; /* 适配 1920 宽度 */
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 30px;
            box-sizing: border-box;
            border-bottom: 3px solid var(--color-border);
            font-size: 1.4rem;
        }

        .header h1 {
            font-size: 2.5rem;
            text-align: center;
            color: var(--color-accent);
            text-shadow: 0 0 15px var(--color-accent);
            flex-grow: 1;
            font-family: var(--digital-font);
        }

        .clock {
            white-space: nowrap;
            font-size: 1rem;
            color: var(--color-secondary);
            font-family: var(--digital-font);
        }

        /* 切换按钮 (在 Scoreboard 页面移除，但保留样式以防万一) */
        #view-toggle, #lang-toggle {
            background: var(--color-bg);
            border: 2px solid var(--color-primary);
            color: var(--color-primary);
            padding: 8px 15px;
            cursor: pointer;
            text-transform: uppercase;
            margin-left: 15px;
            transition: all 0.3s;
            border-radius: 5px;
            font-family: 'Inter', sans-serif;
        }

        #view-toggle:hover, #lang-toggle:hover, .btn:hover {
            box-shadow: 0 0 10px var(--color-primary);
            background-color: #001a00;
        }

        /* ---------------------------------- 计分板 (Frontend) ---------------------------------- */

        #scoreboard {
            display: grid;
            grid-template-columns: 1fr 2fr 1fr;
            width: 90%;
            max-width: 1600px;
            margin: 30px auto;
            border: 5px solid var(--color-primary);
            box-shadow: 0 0 30px rgba(0, 255, 0, 0.5);
            min-height: 700px; /* 确保在大屏上有足够的高度 */
        }

        .team-panel {
            padding: 20px;
            border-right: 3px solid var(--color-border);
            border-left: 3px solid var(--color-border);
            display: flex;
            flex-direction: column;
        }

        #team-b-panel { border-right: none; }
        #team-a-panel { border-left: none; }

        .team-name-display {
            font-size: 3.5rem; /* 增大 */
            color: var(--color-primary);
            text-align: center;
            padding: 10px 0;
            border-bottom: 2px solid var(--color-border);
            margin-bottom: 20px;
            text-shadow: 0 0 10px var(--color-primary);
            font-family: var(--digital-font);
        }

        .personnel-info {
            font-size: 1.2rem; /* 增大 */
            margin-bottom: 15px;
            color: var(--color-accent);
        }
        
        .player-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 5px 0;
            font-size: 1rem; /* 增大 */
            line-height: 1.6;
            border-bottom: 1px dashed #001100;
        }
        
        .player-info {
            font-family: 'Inter', sans-serif;
        }

        .player-score {
            width: 40px;
            text-align: right;
            font-weight: bold;
            color: var(--color-secondary);
            font-family: var(--digital-font);
            font-size: 1.2rem;
        }

        .fouls-grid {
            display: flex;
            gap: 4px;
            width: 40%;
            justify-content: flex-start;
        }

        .foul-box {
            width: 12px;
            height: 12px;
            border: 1px solid var(--color-primary);
            background-color: transparent;
            border-radius: 50%;
        }

        .foul-box.active {
            background-color: var(--color-primary);
            box-shadow: 0 0 5px var(--color-primary);
        }

        /* ---------------------------------- 中央计分区 ---------------------------------- */

        .center-panel {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: space-between;
            padding: 20px 10px;
            gap: 15px;
        }

        #referees-center {
            font-size: 1.1rem;
            color: var(--color-accent);
            text-align: center;
            margin-bottom: 10px;
        }
        
        #team-vs {
            font-size: 1.8rem !important;
            color: var(--color-text) !important;
            border-bottom: none !important;
            text-shadow: none !important;
            margin-bottom: 0 !important;
        }

        .period-display {
            font-size: 2.5rem; /* 增大 */
            color: var(--color-accent);
            padding: 8px 20px;
            border: 3px solid var(--color-accent);
            margin-bottom: 20px;
            font-family: var(--digital-font);
        }

        .main-scores {
            display: grid;
            grid-template-columns: 1fr 1fr;
            width: 100%;
            gap: 20px;
            margin-bottom: 25px;
        }

        .score-a, .score-b {
            font-size: 9rem; /* 大幅增大 */
            line-height: 1;
            text-align: center;
            color: var(--color-secondary);
            text-shadow: 0 0 30px var(--color-secondary);
            border: 5px solid var(--color-secondary);
            padding: 20px 0;
            font-family: var(--digital-font);
            background-color: #1a0a00; /* 略微深红背景 */
        }

        .main-timer {
            font-size: 12rem; /* 大幅增大 */
            line-height: 1;
            color: var(--color-secondary);
            text-shadow: 0 0 40px var(--color-secondary);
            padding: 15px 30px;
            border: 6px solid var(--color-secondary);
            margin-bottom: 25px;
            font-family: var(--digital-font);
            background-color: #1a0a00;
        }

        .control-status {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            width: 100%;
            text-align: center;
            font-size: 1.8rem; /* 增大 */
            margin-bottom: 20px;
        }

        .timeouts-display, .fouls-display {
            display: flex;
            flex-direction: column;
            padding: 10px;
            border: 2px solid var(--color-primary);
            border-radius: 5px;
        }

        .timeouts-display .value, .fouls-display .value {
            font-size: 4rem; /* 增大 */
            color: var(--color-primary);
            line-height: 1;
            font-family: var(--digital-font);
        }
        
        .timeouts-display .label, .fouls-display .label {
            font-size: 1rem;
            color: var(--color-text);
        }
        
        .shot-clock {
            font-size: 8rem; /* 增大 */
            color: var(--color-secondary);
            text-shadow: 0 0 30px var(--color-secondary);
            padding: 10px 0;
            margin-bottom: 20px;
            font-family: var(--digital-font);
        }

        /* ---------------------------------- 后台管理 (Control Panel) ---------------------------------- */
        /* 在 Scoreboard 页面隐藏控制面板 */
        #control-panel {
            display: none;
        }

        .panel-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid var(--color-border);
            border-radius: 5px;
            box-shadow: 0 0 8px rgba(255, 69, 0, 0.4);
        }

        .panel-section h2 {
            color: var(--color-accent);
            border-bottom: 2px solid var(--color-accent);
            padding-bottom: 8px;
            margin-top: 0;
            font-size: 1.8rem;
        }

        .control-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }

        .control-group label {
            font-size: 1rem;
        }

        input[type="text"], input[type="number"] {
            background-color: #1a1a1a;
            border: 1px solid var(--color-border);
            color: var(--color-text);
            padding: 10px;
            font-family: 'Inter', sans-serif;
            font-size: 1.1rem;
            border-radius: 3px;
        }

        .btn {
            padding: 12px 20px;
            font-size: 1rem;
            font-family: 'Inter', sans-serif;
            font-weight: bold;
        }
        
        .player-settings-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
        }
        
        /* 响应式调整 (保持手机可用性) */
        @media (max-width: 768px) {
            .header {
                width: 100%;
                padding: 10px;
            }
            .header h1 {
                font-size: 1.2rem;
            }
            #scoreboard {
                grid-template-columns: 1fr 1fr;
                min-height: auto;
                width: 98%;
                margin: 10px auto;
            }
            .center-panel {
                grid-column: 1 / 3;
                order: -1;
            }
            .team-panel {
                padding: 10px;
            }
            .main-timer {
                font-size: 4rem;
            }
            .score-a, .score-b {
                font-size: 3rem;
            }
            .shot-clock {
                font-size: 3rem;
            }
            .player-settings-grid {
                grid-template-columns: 1fr;
            }
            #control-panel {
                width: 98%;
                padding: 15px;
            }
        }
    </style>
</head>
<body>

    <div class="header">
        <span id="referees-placeholder"></span>
        <h1 id="app-title"></h1>
        <div class="header-controls">
            <button id="lang-toggle" class="btn primary"></button>
            <div id="real-time-clock" class="clock"></div>
        </div>
    </div>

    <div id="app-modal" class="modal">
        <div class="modal-content">
            <p id="modal-message"></p>
            <div id="modal-actions">
                </div>
        </div>
    </div>

    <div id="scoreboard">
        <div id="team-a-panel" class="team-panel">
            <div id="team-a-name-display" class="team-name-display"></div>
            <div class="personnel-info">
                <span id="coach-a-display"></span>
            </div>
            <div id="players-a-list">
                </div>
        </div>

        <div class="center-panel">
            <div id="referees-center">
                <div id="ref-main-display"></div>
                <div id="ref-vice-display"></div>
            </div>
            <div id="team-vs" class="team-name-display"></div>

            <div id="period-display" class="period-display"></div>

            <div class="main-scores">
                <div id="score-a" class="score-a">0</div>
                <div id="score-b" class="score-b">0</div>
            </div>

            <div id="main-timer" class="main-timer">00:00</div>
            
            <div id="shot-clock" class="shot-clock">24</div>

            <div class="control-status">
                <div id="timeouts-display" class="timeouts-display">
                    <span id="timeouts-a-value" class="value">0</span>
                    <span id="timeouts-label" class="label"></span>
                    <span id="timeouts-b-value" class="value">0</span>
                </div>
                <div id="fouls-display" class="fouls-display">
                    <span id="fouls-a-value" class="value">0</span>
                    <span id="fouls-label" class="label"></span>
                    <span id="fouls-b-value" class="value">0</span>
                </div>
            </div>
            
        </div>

        <div id="team-b-panel" class="team-panel">
            <div id="team-b-name-display" class="team-name-display"></div>
            <div class="personnel-info">
                <span id="coach-b-display"></span>
            </div>
            <div id="players-b-list">
                </div>
        </div>
    </div>

    <div id="control-panel" style="display: none;">
        </div>

    <script>
        // ---------------------------------- 全局状态与配置 ----------------------------------
        let gameState = {
            // 比赛设置 (实时保存)
            gameName: "2016篮球比赛计时计分系统",
            teamA: "NBA",
            teamB: "CBA",
            refereeMain: "王伟",
            refereeVice: "李强",
            coachA: "张指导",
            coachB: "刘教练",
            
            // 比赛参数 (需点击应用)
            periodDuration: 300, // 5 minutes in seconds
            totalPeriods: 4,
            shotClockInitial: 24,

            // 比赛实时状态
            currentPeriod: 1,
            timer: 300,
            shotClock: 24,
            isTimerRunning: false,
            timerInterval: null,
            shotClockInterval: null,

            // 比分及犯规
            scoreA: 0,
            scoreB: 0,
            foulsA: 0,
            foulsB: 0,
            timeoutsA: 0,
            timeoutsB: 0,

            // 球员得分 (简化版，仅显示名字和总得分)
            playersA: Array.from({ length: 12 }, (_, i) => ({ id: i + 1, name: `队员 ${i + 1}`, score: 0, fouls: 0 })),
            playersB: Array.from({ length: 12 }, (_, i) => ({ id: i + 1, name: `队员 ${i + 1}`, score: 0, fouls: 0 })),
            
            // 记录
            periodScores: [],
        };

        let currentLang = 'zh';

        // ---------------------------------- 翻译数据 ----------------------------------
        const translations = {
            'zh': {
                'app-title': '篮球比赛计时计分系统',
                'view-toggle-score': '切换到控制面板',
                'view-toggle-control': '切换到计分板',
                'modal-ok': '确定',
                'modal-cancel': '取消',
                'meta-title': '比赛元数据 (实时保存)',
                'personnel-title': '管理人员信息 (实时保存)',
                'settings-title': '比赛参数设置 (需点击应用)',
                'label-game-name': '比赛名称',
                'label-team-a-name': '队伍 A 名称',
                'label-team-b-name': '队伍 B 名称',
                'label-referee-main': '主裁判',
                'label-referee-vice': '副裁判',
                'label-coach-a': '队伍 A 主教练',
                'label-coach-b': '队伍 B 主教练',
                'label-period-duration': '每节时长 (秒)',
                'label-total-periods': '总结数',
                'label-shot-clock': '进攻时钟 (秒)',
                'apply-settings-btn': '应用比赛参数',
                'team-player-title': '球员信息 (实时保存)',
                'team-a-label': '队伍 A 球员',
                'team-b-label': '队伍 B 球员',
                'player-placeholder': '球员名称',
                'control-title': '比赛控制',
                'timer-control-title': '倒计时管理',
                'score-control-title': '比分和其他控制',
                'timer-start-btn-start': '开始计时',
                'timer-start-btn-pause': '暂停计时',
                'timer-reset-btn': '重置计时',
                'shot-clock-reset-btn': '重置进攻时钟',
                'next-period-btn': '下一节比赛',
                'control-team-a': '队伍 A',
                'control-team-b': '队伍 B',
                'log-title': '得分记录与导出',
                'export-log-btn': '导出得分记录 (.txt)',
                'clear-log-btn': '清除记录',
                'reset-all-btn': '一键重置所有比赛信息',
                'ref-main-prefix': '主裁判:',
                'ref-vice-prefix': '副裁判:',
                'coach-a-prefix': '主教练:',
                'coach-b-prefix': '主教练:',
                'period-label': '第',
                'period-unit': '节',
                'timeout-label': '暂停',
                'foul-label': '犯规',
                'msg-game-start': '比赛已开始！',
                'msg-game-paused': '比赛已暂停！',
                'msg-period-end': '第 {0} 节比赛结束，比分 {1} - {2}',
                'msg-game-end': '比赛结束！最终比分 {0} - {1}',
                'msg-reset-confirm': '您确定要重置所有比赛信息吗？此操作不可撤销。',
                'msg-settings-applied': '比赛参数已应用。',
                'msg-foul-max': '队伍犯规已达上限 (5次)。',
                'msg-timeout-max': '暂停次数不能低于 0。',
                'msg-log-cleared': '得分记录已清除。',
            },
            'en': {
                'app-title': 'Basketball Scoreboard System',
                'view-toggle-score': 'Switch to Control Panel',
                'view-toggle-control': 'Switch to Scoreboard',
                'modal-ok': 'OK',
                'modal-cancel': 'Cancel',
                'meta-title': 'Game Metadata (Real-time Saved)',
                'personnel-title': 'Personnel Info (Real-time Saved)',
                'settings-title': 'Game Parameters (Requires Apply)',
                'label-game-name': 'Game Name',
                'label-team-a-name': 'Team A Name',
                'label-team-b-name': 'Team B Name',
                'label-referee-main': 'Main Referee',
                'label-referee-vice': 'Vice Referee',
                'label-coach-a': 'Team A Head Coach',
                'label-coach-b': 'Team B Head Coach',
                'label-period-duration': 'Period Duration (Seconds)',
                'label-total-periods': 'Total Periods',
                'label-shot-clock': 'Shot Clock (Seconds)',
                'apply-settings-btn': 'Apply Game Parameters',
                'team-player-title': 'Player Info (Real-time Saved)',
                'team-a-label': 'Team A Players',
                'team-b-label': 'Team B Players',
                'player-placeholder': 'Player Name',
                'control-title': 'Game Control',
                'timer-control-title': 'Timer Management',
                'score-control-title': 'Score and Control',
                'timer-start-btn-start': 'Start Timer',
                'timer-start-btn-pause': 'Pause Timer',
                'timer-reset-btn': 'Reset Timer',
                'shot-clock-reset-btn': 'Reset Shot Clock',
                'next-period-btn': 'Next Period',
                'control-team-a': 'Team A',
                'control-team-b': 'Team B',
                'log-title': 'Score Log and Export',
                'export-log-btn': 'Export Score Log (.txt)',
                'clear-log-btn': 'Clear Log',
                'reset-all-btn': 'Reset All Game Info',
                'ref-main-prefix': 'Main Ref:',
                'ref-vice-prefix': 'Vice Ref:',
                'coach-a-prefix': 'Head Coach:',
                'coach-b-prefix': 'Head Coach:',
                'period-label': 'Period',
                'period-unit': '',
                'timeout-label': 'Timeout',
                'foul-label': 'Foul',
                'msg-game-start': 'Game Started!',
                'msg-game-paused': 'Game Paused!',
                'msg-period-end': 'End of Period {0}, Score {1} - {2}',
                'msg-game-end': 'Game Over! Final Score {0} - {1}',
                'msg-reset-confirm': 'Are you sure you want to reset all game data? This cannot be undone.',
                'msg-settings-applied': 'Game parameters applied.',
                'msg-foul-max': 'Team foul limit (5) reached.',
                'msg-timeout-max': 'Timeout count cannot go below 0.',
                'msg-log-cleared': 'Score log cleared.',
            }
        };

        /**
         * 替换翻译字符串中的占位符 {0}, {1}...
         */
        function getTranslation(key, ...args) {
            let text = translations[currentLang][key] || key;
            args.forEach((arg, index) => {
                text = text.replace(new RegExp(`\\{${index}\\}`, 'g'), arg);
            });
            return text;
        }

        // ---------------------------------- 模态框 (替代 alert/confirm) ----------------------------------

        /**
         * 显示自定义消息模态框 (取代 alert)
         * **注意：此页面（Scoreboard）不会调用涉及控制台的功能**
         */
        function showModal(messageKey, ...args) {
            const modal = document.getElementById('app-modal');
            document.getElementById('modal-message').innerHTML = getTranslation(messageKey, ...args);
            
            const actions = document.getElementById('modal-actions');
            actions.innerHTML = `<button class="btn primary" onclick="document.getElementById('app-modal').style.display='none'">${getTranslation('modal-ok')}</button>`;
            
            modal.style.display = 'block';
        }

        /**
         * 显示确认模态框 (取代 confirm)
         * **注意：此页面（Scoreboard）不会调用涉及控制台的功能**
         */
        function showConfirmModal(messageKey, onConfirm) {
            const modal = document.getElementById('app-modal');
            document.getElementById('modal-message').innerHTML = getTranslation(messageKey);
            
            const actions = document.getElementById('modal-actions');
            actions.innerHTML = `
                <button class="btn danger" id="modal-confirm-btn">${getTranslation('modal-ok')}</button>
                <button class="btn" onclick="document.getElementById('app-modal').style.display='none'">${getTranslation('modal-cancel')}</button>
            `;
            
            document.getElementById('modal-confirm-btn').onclick = () => {
                onConfirm();
                document.getElementById('app-modal').style.display = 'none';
            };
            
            modal.style.display = 'block';
        }

        // ---------------------------------- 初始化与视图渲染 ----------------------------------

        /**
         * 切换语言
         */
        function toggleLanguage() {
            currentLang = currentLang === 'zh' ? 'en' : 'zh';
            document.documentElement.lang = currentLang;
            renderUI();
        }
        
        /**
         * 渲染所有需要翻译和动态显示的内容
         */
        function renderUI() {
            // 1. 顶部栏
            document.getElementById('app-title').textContent = getTranslation('app-title');
            document.getElementById('lang-toggle').textContent = currentLang === 'zh' ? 'EN / 中文' : 'ZH / English';
            // 移除 view-toggle 相关的逻辑
            
            // 2. 计分板 (Scoreboard) - 实时元数据
            document.getElementById('team-a-name-display').textContent = gameState.teamA;
            document.getElementById('team-b-name-display').textContent = gameState.teamB;
            document.getElementById('team-vs').textContent = `${gameState.teamA} VS ${gameState.teamB}`;
            
            document.getElementById('ref-main-display').textContent = `${getTranslation('ref-main-prefix')} ${gameState.refereeMain}`;
            document.getElementById('ref-vice-display').textContent = `${getTranslation('ref-vice-prefix')} ${gameState.refereeVice}`;
            document.getElementById('coach-a-display').textContent = `${getTranslation('coach-a-prefix')} ${gameState.coachA}`;
            document.getElementById('coach-b-display').textContent = `${getTranslation('coach-b-prefix')} ${gameState.coachB}`;

            // 3. 计分板 (Scoreboard) - 比赛状态
            document.getElementById('period-display').textContent = `[${getTranslation('period-label')}${gameState.currentPeriod}${getTranslation('period-unit')}]`;

            document.getElementById('score-a').textContent = gameState.scoreA;
            document.getElementById('score-b').textContent = gameState.scoreB;
            document.getElementById('fouls-a-value').textContent = gameState.foulsA;
            document.getElementById('fouls-b-value').textContent = gameState.foulsB;
            document.getElementById('fouls-label').textContent = getTranslation('foul-label');
            document.getElementById('timeouts-a-value').textContent = gameState.timeoutsA;
            document.getElementById('timeouts-b-value').textContent = gameState.timeoutsB;
            document.getElementById('timeouts-label').textContent = getTranslation('timeout-label');
            
            document.getElementById('shot-clock').textContent = gameState.shotClock;

            // 4. 计分板 - 球员列表
            renderPlayerList('a');
            renderPlayerList('b');
            
            // 5. 后台控制 (Control Panel) - 静态文本和输入框内容 (不渲染或不操作)
            
        }

        /**
         * 渲染球员列表 (Scoreboard Only)
         */
        function renderPlayerList(team) {
            const listEl = document.getElementById(`players-${team}-list`);
            const players = team === 'a' ? gameState.playersA : gameState.playersB;
            
            listEl.innerHTML = '';

            players.forEach((player) => {
                // Scoreboard Display
                const row = document.createElement('div');
                row.className = 'player-row';
                row.innerHTML = `
                    <span class="player-info">
                        <span style="color: var(--color-secondary); font-family: var(--digital-font);">${String(player.id).padStart(2, '0')}</span> 
                        &nbsp;${player.name}
                    </span>
                    <div class="fouls-grid">
                        ${Array(5).fill(0).map((_, i) => 
                            `<div class="foul-box ${i < player.fouls ? 'active' : ''}"></div>`).join('')}
                    </div>
                    <span class="player-score">${player.score}</span>
                `;
                listEl.appendChild(row);

                // Control Panel Inputs (此页面不需要，不渲染)
            });
        }
        
        /**
         * 实时时钟
         */
        function updateRealTimeClock() {
            const now = new Date();
            const year = now.getFullYear();
            const month = String(now.getMonth() + 1).padStart(2, '0');
            const day = String(now.getDate()).padStart(2, '0');
            const hours = String(now.getHours()).padStart(2, '0');
            const minutes = String(now.getMinutes()).padStart(2, '0');
            const seconds = String(now.getSeconds()).padStart(2, '0');
            document.getElementById('real-time-clock').textContent = `${year}-${month}-${day} ${hours}:${minutes}:${seconds}`;
        }
        
        // ---------------------------------- 比赛逻辑 (仅监听，不控制) ----------------------------------

        /**
         * 格式化时间为 MM:SS
         */
        function formatTime(totalSeconds) {
            const minutes = Math.floor(totalSeconds / 60);
            const seconds = totalSeconds % 60;
            return `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
        }

        // ---------------------------------- 本地存储与实时保存 ----------------------------------

        /**
         * 从 localStorage 加载游戏状态
         * **注意：这个页面需要加载所有的比赛状态，因为它是显示器。**
         */
        function loadGameState() {
            const savedState = localStorage.getItem('basketballScoreboardState');
            if (savedState) {
                const loadedData = JSON.parse(savedState);
                
                // 加载元数据 (实时保存)
                gameState.gameName = loadedData.gameName || gameState.gameName;
                gameState.teamA = loadedData.teamA || gameState.teamA;
                gameState.teamB = loadedData.teamB || gameState.teamB;
                gameState.refereeMain = loadedData.refereeMain || gameState.refereeMain;
                gameState.refereeVice = loadedData.refereeVice || gameState.refereeVice;
                gameState.coachA = loadedData.coachA || gameState.coachA;
                gameState.coachB = loadedData.coachB || gameState.coachB;

                // 加载参数 (需应用)
                gameState.periodDuration = loadedData.periodDuration || gameState.periodDuration;
                gameState.totalPeriods = loadedData.totalPeriods || gameState.totalPeriods;
                gameState.shotClockInitial = loadedData.shotClockInitial || gameState.shotClockInitial;
                
                // 加载球员数据（包括得分和犯规，Admin 页面会写入）
                if (loadedData.playersA) gameState.playersA.forEach((p, i) => { 
                    if(loadedData.playersA[i]) { 
                        p.name = loadedData.playersA[i].name;
                        p.score = loadedData.playersA[i].score || 0; // 确保加载得分
                        p.fouls = loadedData.playersA[i].fouls || 0; // 确保加载犯规
                    }
                });
                if (loadedData.playersB) gameState.playersB.forEach((p, i) => { 
                    if(loadedData.playersB[i]) { 
                        p.name = loadedData.playersB[i].name;
                        p.score = loadedData.playersB[i].score || 0; // 确保加载得分
                        p.fouls = loadedData.playersB[i].fouls || 0; // 确保加载犯规
                    }
                });

                // 加载实时比赛状态（Score、Fouls、Timeouts, Current Period, Timer, ShotClock）
                gameState.currentPeriod = loadedData.currentPeriod || gameState.currentPeriod;
                gameState.scoreA = loadedData.scoreA || gameState.scoreA;
                gameState.scoreB = loadedData.scoreB || gameState.scoreB;
                gameState.foulsA = loadedData.foulsA || gameState.foulsA;
                gameState.foulsB = loadedData.foulsB || gameState.foulsB;
                gameState.timeoutsA = loadedData.timeoutsA || gameState.timeoutsA;
                gameState.timeoutsB = loadedData.timeoutsB || gameState.timeoutsB;
                gameState.timer = loadedData.timer || gameState.periodDuration;
                gameState.shotClock = loadedData.shotClock || gameState.shotClockInitial;
                gameState.isTimerRunning = loadedData.isTimerRunning || false;

                // 记录不需要在 Scoreboard 上显示，但可加载
                gameState.periodScores = loadedData.periodScores || gameState.periodScores;
                
            }
            // Scoreboard 页面不需要额外的 resetGameStatus()，只需要加载并显示当前状态。
        }

        // ---------------------------------- 状态同步（Scoreboard 核心） ----------------------------------
        
        /**
         * 启动一个循环，不断从 localStorage 加载最新状态并渲染
         * 模拟两个页面之间的“通信”
         */
        function startStateSync() {
            // 首先，将 loadGameState 移动到这个同步函数内，以便每次都重新加载状态。
            // 为了避免覆盖 Admin 页面可能正在进行的操作，Scoreboard 页面**不执行任何写入操作**。
            
            // 每次同步时重新加载并渲染
            loadGameState();
            
            // 重新设置计时器显示，但不启动 interval，因为 Admin 页面正在运行 interval
            document.getElementById('main-timer').textContent = formatTime(gameState.timer);
            
            // 渲染所有UI元素
            renderUI();
        }

        // ---------------------------------- 启动 ----------------------------------
        
        window.onload = function() {
            // 1. 启动状态同步，每隔一小段时间（例如 100 毫秒）从 localStorage 读取最新状态
            // 这确保了 Scoreboard 能够实时反映 Admin 页面的操作。
            setInterval(startStateSync, 100); 
            
            // 2. 绑定事件监听器 (仅语言切换)
            document.getElementById('lang-toggle').addEventListener('click', toggleLanguage);
            
            // 3. 启动实时时钟
            setInterval(updateRealTimeClock, 1000);
            updateRealTimeClock();
        };

        // **重要：删除所有在 Scoreboard 页面不应该被调用的控制功能**
        // Scoreboard 页面不再包含 Admin 页面的控制逻辑 (saveMetadata, updateScore, resetTimer, etc.)

    </script>
</body>
</html>